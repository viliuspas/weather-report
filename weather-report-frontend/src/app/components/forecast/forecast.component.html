@let place = currentPlace();

@if (place) {
    <hr class="m-0"/>
    <div class="content-container h-100">
        <div class="d-flex flex-column flex-sm-row align-items-center">
            <div class="heading-container card">
                <div class="flex-container">
                    <h2 class="m-0">{{ place.place.name }}</h2>
                    <span class="small text-secondary">{{ place.place.administrativeDivision }}</span>
                </div>
                
                <div class="flex-container">
                    <span class="fs-2">
                        {{ place.forecastTimestamps[0].airTemperature }}°C
                    </span>
                    <span class="small">
                        Feels like {{ place.forecastTimestamps[0].feelsLikeTemperature }}°C
                    </span>
                </div>
            </div>

            <div class="d-flex flex-row flex-sm-column p-1 p-sm-3 pe-sm-0 justify-content-center">
                <div class="info-row">
                    <app-icon class="py-1" [type]="conditionCodeToIconType(place.forecastTimestamps[0].conditionCode)" />
                    <span class="d-none d-sm-inline-flex">{{ place.forecastTimestamps[0].conditionCode | conditionCode }}</span>
                </div>
                <span class="d-inline-flex d-sm-none mx-3">•</span>
                <div class="info-row">
                    <span class="d-none d-sm-inline-flex">Wind speed </span>
                    <span>{{ place.forecastTimestamps[0].windSpeed }} m/s</span>
                    <app-icon [type]="IconType.ARROW_UP" [rotate]="180 + place.forecastTimestamps[0].windDirection"/>
                </div>
                <span class="d-inline-flex d-sm-none mx-3">•</span>
                <div class="info-row">
                    <span class="d-none d-sm-inline-flex">Humidity </span>
                    <span>{{ place.forecastTimestamps[0].relativeHumidity }}%</span>
                    <app-icon [type]="IconType.DROPLET_HALF"/>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header d-flex flex-row align-items-center">
                <span>{{ this.selectedDay() === 0 ?
                    'Next 24 hours' : dailyForecast()[0].forecastTimeUtc | dateTime: 'mmm dd' }}
                </span>
                <div class="ms-auto">
                    <button class="btn nav-button" [class.disabled]="selectedDay() <= 0" (click)="handlePrevDay()">
                        <app-icon [type]="IconType.CHEVRON_RIGHT" [rotate]="180" />
                    </button>
                    <button class="btn nav-button" [class.disabled]="selectedDay() >= 5" (click)="handleNextDay()">
                        <app-icon [type]="IconType.CHEVRON_RIGHT"/>
                    </button>
                </div>
            </div>
            <div class="overflow-x-scroll">
                <table class="text-center w-100">
                    <thead>
                        @for (item of dailyForecast(); track $index) {
                            <th class="t-cell py-2 px-3">{{ item.forecastTimeUtc | dateTime: 'hh:mm' }}</th>
                        }
                    </thead>
                    <tbody>
                        <tr>
                            @for (item of dailyForecast(); track $index) {
                                <td class="t-cell">{{ item.airTemperature }}°C</td>
                            }
                        </tr>
                        <tr>
                            @for (item of dailyForecast(); track $index) {
                                <td class="t-cell">
                                    <div class="d-flex flex-row align-items-center justify-content-center">
                                        <app-icon [type]="conditionCodeToIconType(item.conditionCode)" />
                                    </div>
                                </td>
                            }
                        </tr>
                        <tr>
                            @for (item of dailyForecast(); track $index) {
                                <td class="t-cell">
                                    <div class="gap-1 d-flex flex-row align-items-center justify-content-center">
                                        <app-icon [type]="IconType.DROPLET"/>
                                        <span class="nowrap">{{ item.totalPrecipitation }} mm</span>
                                    </div>
                                </td>
                            }
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <hr class="m-0"/>
}
